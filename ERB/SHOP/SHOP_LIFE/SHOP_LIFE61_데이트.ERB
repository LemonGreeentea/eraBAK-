;-------------------------------------------------
; 블루아카 K 데이트 시스템
; 개조자 : 레몬녹차
; 개조시작 : 2024. 5. 4. / 최종수정 : 2024. 5. 5.
; 시스템 설명 : 기존 밋밋했던 데이트 시스템을 개편하여 장소에 따른 보상을 변경하고
;              캐릭터별 구상 출력 시스템 추가.
;
; 주요 기능
;   1. 데이트 장소 변경(블루아카에 맞는 장소)
;   2. 크레딧 소모량 변경(장소별 차등)
;   3. 장소 이미지 추가
;   4. 캐릭터 데이트구상 출력 시스템 추가(템플릿 파일도 추가)
;   5. 데이트 조건(안면있음) 및 횟수 제한(캐릭마다 턴당 1회)
;
; 추가 예정 기능
;   1. 특정 지역을 점령하거나 점령한 세력과 동맹일 시 갈 수 있는 데이트 장소 추가(ex. 크루즈선 등)
;
;-------------------------------------------------
;「데이트」의 명칭
;-------------------------------------------------
@SHOP_LIFE_NAME61
RESULTS:0 '= "데이트"

;-------------------------------------------------
;「데이트」의 선택 가부 판정
;-------------------------------------------------
@SHOP_LIFE_CHECK61
;데이트대 부족
;SIF MONEY < 3000
;	RETURN 0
SIF CFLAG:MASTER:포로처
	RETURN 0
SIF !CFLAG:MASTER:소속
	RETURN 0
RETURN 1

;-------------------------------------------------
;「데이트」의 선택 가능 캐릭터 존재 판정（권할 수 있는 캐릭터）
;-------------------------------------------------
@SHOP_LIFE_CHECKCHARA61(ARG:0)
;비주인공, 동일 세력, 포로가 아닌, 동물이 아닌, 통상 상태 또는 육아중 + 안면 있음
RETURN ARG:0 != MASTER && CFLAG:(ARG:0):소속 == CFLAG:MASTER:소속 && CFLAG:(ARG:0):안면 && !CFLAG:(ARG:0):데이트행동완료 && CFLAG:(ARG:0):포로처 == 0 && !IS_ANIMAL(ARG:0) && GROUPMATCH(CFLAG:(ARG:0):행동불능상태, 0, 2)

;-------------------------------------------------
;「데이트의 왼쪽 컬럼 메뉴의 입력 처리
;-------------------------------------------------
@SHOP_LIFE_EVENTBUY61
FLAG:거점페이즈페이지 = 1
FLAG:요바이 = 0
RETURN 0

;-------------------------------------------------
;「데이트」의 오른쪽 컬럼 표시 처리
;-------------------------------------------------
@SHOP_LIFE_EVENTBUY_SHOW61
;타이틀
CALL COLUMN_RIGHT_TITLE("대상자 선택", "0", "1", "1～모두", "3, 000～", "자기세력, 안면있음")
CALL COLUMN_RIGHT_PRINTL
CALL COLUMN_RIGHT_LINE
CALL COLUMN_RIGHT_PRINTL
;오른쪽 컬럼의 표준적인 캐릭터 리스트와 페이지 이동 호출
CALL COLUMN_RIGHT_CHARALIST
RETURN

;-------------------------------------------------
;「데이트」의 이미지 표시
;-------------------------------------------------
@SHOP_LIFE_Illust61(String,SIZE)
#DIM iSize
#DIMS sHtml
#DIM iFont_Hei_mag
#DIM iEnter_Con
#DIM iSpace
#DIMS String
#DIM SIZE
#DIM SPACE_LIST
#DIM Integer
#DIM iID

SIF SIZE == 0
    SIZE = 700
iEnter_Con = 0
sHtml =  <p align='left'><nobr>
sHtml += @"<shape type='space' param='{iSpace}'><img src='%String%' height='{SIZE}' ypos='100'>"
HTML_PRINT sHtml

RETURN 0

;-------------------------------------------------
;「데이트」의 수락 확률 계산
;-------------------------------------------------
;@SHOP_LIFE_Chance61
;#FUNCTIONS
;난이도 계산
;LOCALS = 확실
;글자출력
;불가능, 낮음, 보통, 높음, 확실

;SETCOLOR 0x0099FF
;PRINTFORMW 확실
;RESETCOLOR 
;RETURNF LOCALS

@SHOP_LIFE_Chance61_PRINT(대상,장소)
#DIM 대상
#DIMS 장소

PRINTFORM <수락확률 : 
;확률 계산
;IF 
SETCOLOR 0x0099FF
PRINTFORM 확실
RESETCOLOR 
PRINTFORM > 
RETURN

;-------------------------------------------------
;「데이트」의 리스트 1 입력 처리
;-------------------------------------------------
@SHOP_LIFE_USERSHOP61(대상)
#DIM FIRST_LINE
#DIM 대상, 1
#DIM 결과, 1
#DIM 전소비, 1
#DIM 내용, 1
#DIM 능력, 1
#DIM 이벤트발생, 1

FLAG:능력표시모드 = 0

FIRST_LINE = LINECOUNT
$INPUT_LOOP

이벤트발생 = 0
LOCAL:5 = 0
CALL SINGLE_DRAWLINE
PRINTFORML 행동력과 크레딧을 사용하여 %조사처리(ANAME(대상),"와")% 데이트 합니다.
PRINTFORML 어디로 갈까요?(거절 시 돈, 아이템, 행동 소모 없음)
PRINTFORML 
PRINTFORML ※ 현재 개발중이라 무조건 수락
PRINTFORML 남은행동:{CALC_SHOP_TIME() - SHOP_TIME}
PRINTFORML 크레딧:%NUM_FORMAT(MONEY)%
CALL SINGLE_DRAWLINE
;--------------------------------------------------
; 공원 - 크레딧이 들지 않고, 가장 수락확률이 높다.
; 음란도가 높으면 야외엣치 등을 할 수 있으면 좋을듯?
;--------------------------------------------------
CALL SHOP_LIFE_Illust61("DatePlace01")
PRINT                              
PRINTBUTTON @"%"[공원]", 20, LEFT%", 1
PRINTL
PRINT                               
PRINTFORM <소모 크레딧 : 0>  
CALL SHOP_LIFE_Chance61_PRINT(대상,"공원")
PRINTL 
PRINT                               
PRINTFORML 공원에서 데이트합니다. 
PRINTL 
PRINT                               
PRINTFORML 
PRINT                               
PRINTFORML
PRINT                               
PRINTFORML

;--------------------------------------------------
; 시내 - 선물을 주거나 같이 음식을 먹을 수 있음.(크레딧 소비)
;--------------------------------------------------
CALL SHOP_LIFE_Illust61("DatePlace02")
PRINT                              
PRINTBUTTON @"%"[시내]", 20, LEFT%", 2
PRINTL
PRINT                               
PRINTFORM <소모 크레딧 : 1,000>  
CALL SHOP_LIFE_Chance61_PRINT(대상,"시내")
PRINTL 
PRINT                               
PRINTFORML 시내를 돌아다니면서 데이트합니다.
PRINTL 
PRINT                               
PRINTFORML 선물을 사주거나 맛있는 음식을 먹습니다.
PRINT                               
PRINTFORML
PRINT                               
PRINTFORML
PRINT                               
PRINTFORML

;--------------------------------------------------
; 게임센터 - 
;--------------------------------------------------
CALL SHOP_LIFE_Illust61("DatePlace03")
PRINT                              
PRINTBUTTON @"%"[게임센터]", 20, LEFT%", 3
PRINTL
PRINT                               
PRINTFORM <소모 크레딧 : 3,000>  
CALL SHOP_LIFE_Chance61_PRINT(대상,"게임센터")
PRINTL 
PRINT                               
PRINTFORML 게임센터에서 데이트합니다. 
PRINT                               
PRINTFORML 
PRINT                               
PRINTFORML
PRINT                               
PRINTFORML
PRINT                               
PRINTFORML

CALL SHOP_LIFE_Illust61("DatePlace04")
PRINT                              
PRINTBUTTON @"%"[놀이공원]", 20, LEFT%", 4
PRINTL
PRINT                               
PRINTFORM <소모 크레딧 : 7,000>  
CALL SHOP_LIFE_Chance61_PRINT(대상,"놀이공원")
PRINTL 
PRINT                               
PRINTFORML 종일권을 끊고 놀이공원에서 놉니다.
PRINT                               
PRINTFORML 
PRINT                               
PRINTFORML
PRINT                               
PRINTFORML
PRINT                               
PRINTFORML

CALL SHOP_LIFE_Illust61("DatePlace05")
PRINT                              
PRINTBUTTON @"%"[혼욕온천]", 20, LEFT%", 5
PRINTL
PRINT                               
PRINTFORM <소모 크레딧 : 10,000>  
CALL SHOP_LIFE_Chance61_PRINT(대상,"온천")
PRINTL 
PRINT                               
PRINTFORML 온천 티켓을 사용하여 혼욕 온천에 갑니다.
PRINT                               
PRINTFORML 
PRINT                               
PRINTFORML
PRINT                               
PRINTFORML
PRINT                               
PRINTFORML

CALL SINGLE_DRAWLINE
PRINTBUTTON "[0] - 돌아온다", 0
PRINTFORML


INPUT 0

내용 = RESULT
;0라면 되돌아간다.
IF 내용 == 0
	RETURN 0
ENDIF


;공원, 소모 크레딧 0
IF 내용 == 1
	PRINTFORML %ANAME(대상)%에게 공원 데이트를 신청하시겠습니까?
	PRINTFORM <소모 크레딧 : 0>  
	CALL SHOP_LIFE_Chance61_PRINT(대상,"공원")
	PRINTL 
	CALL ASK_YN
	IF RESULT == 1
		CLEARLINE LINECOUNT - FIRST_LINE
		GOTO INPUT_LOOP
	ENDIF
	CALL SHOP_LIFE61_DATE_PLACE1(대상)
	CFLAG:대상:데이트행동완료 ++
	RETURN 1
;시내, 소모 크레딧 0
ELSEIF 내용 == 2
	IF MONEY < 1000
		CLEARLINE LINECOUNT - FIRST_LINE
		GOTO INPUT_LOOP
	ELSE

	ENDIF
;게임센터, 소모 크레딧 3,000
ELSEIF 내용 == 3
	IF MONEY < 3000
		CLEARLINE LINECOUNT - FIRST_LINE
		GOTO INPUT_LOOP
	ELSE

	ENDIF
;놀이공원, 소모크레딧 7,000
ELSEIF 내용 == 4
	IF MONEY < 7000
		CLEARLINE LINECOUNT - FIRST_LINE
		GOTO INPUT_LOOP
	ELSE

	ENDIF
;혼욕온천, (임시)소모크레딧 10,000
ELSEIF 내용 == 5
	IF MONEY < 10000
		CLEARLINE LINECOUNT - FIRST_LINE
		GOTO INPUT_LOOP
	ELSE

	ENDIF
ELSE
	GOTO INPUT_LOOP
ENDIF



IF GROUPMATCH(내용, 11, 12, 13, 14, 15, 16)
	IF MONEY < 3000 * (CALC_SHOP_TIME() - SHOP_TIME)
		PRINTFORMW 돈이 충분하지 않습니다.
		CLEARLINE LINECOUNT - FIRST_LINE
		GOTO INPUT_LOOP
	ELSE
		전소비 = 1
		내용 -= 10
		LOCAL:5 = 1
	ENDIF
ELSEIF GROUPMATCH(내용, 1, 2, 3, 4 ,5)
	IF MONEY < 3000
		PRINTFORMW 돈이 충분하지 않습니다.
		CLEARLINE LINECOUNT - FIRST_LINE
		GOTO INPUT_LOOP
	ELSE
		전소비 = 0
	ENDIF
ELSE
	GOTO INPUT_LOOP
ENDIF

;전소비의 경우 여기로 돌아온다
$DATE_LOOP

SHOP_TIME += 1
SHOP_WORK_COUNT += 1


;결과의 계산
SELECTCASE RAND:100
	CASE 0 TO 19
		결과 = 0
	CASE 20 TO 79
		결과 = 1
	CASEELSE
		결과 = 2
ENDSELECT

SELECTCASE 내용
	CASE 1
		IF LOCAL:5 == 0
			PRINTFORML %조사처리(ANAME(대상),"를")% 호수로 이끌었다.
		ELSE
			PRINTFORML 계속호수로 %조사처리(ANAME(대상),"와")% 즐겼다.
		ENDIF
		능력 = ABL:MASTER:무투
	CASE 2
		IF LOCAL:5 == 0
			PRINTFORML %조사처리(ANAME(대상),"를")% 산으로 이끌었다.
		ELSE
			PRINTFORML 계속산에서 %조사처리(ANAME(대상),"와")% 즐겼다.
		ENDIF
		능력 = ABL:MASTER:방위
	CASE 3
		IF LOCAL:5 == 0
			PRINTFORML %조사처리(ANAME(대상),"를")% 숲으로 이끌었다.
		ELSE
			PRINTFORML 계속숲에서 %조사처리(ANAME(대상),"와")% 즐겼다.
		ENDIF
		능력 = ABL:MASTER:지략
	CASE 4
		IF LOCAL:5 == 0
			PRINTFORML %조사처리(ANAME(대상),"를")% 마을로 이끌었다.
		ELSE
			PRINTFORML 계속 마을에서 %조사처리(ANAME(대상),"와")% 즐겼다.
		ENDIF
		능력 = ABL:MASTER:정치
	CASE 5
		IF LOCAL:5 == 0
			PRINTFORML %조사처리(ANAME(대상),"를")% 꽃밭으로 이끌었다.
		ELSE
			PRINTFORML 계속 꽃밭으로 %조사처리(ANAME(대상),"와")% 즐겼다.
		ENDIF
		능력 = ABL:MASTER:가창
	CASE 6
		IF LOCAL:5 == 0
			PRINTFORML %조사처리(ANAME(대상),"를")% 자택으로 이끌었다.
		ELSE
			PRINTFORML 계속 자택에서 %조사처리(ANAME(대상),"와")% 즐겼다.
		ENDIF
		능력 = ABL:MASTER:요리
	CASEELSE
		GOTO INPUT_LOOP
ENDSELECT

;구상으로 캐릭터마다별의 대사를 말하게 할 수 있도록(듯이)하고 싶다
SELECTCASE RAND:5
	CASE 0
		PRINTFORMW %PRONOUN(대상)%는 즐겨 주고 있는 것 같다.
	CASE 1
		PRINTFORMW 둘이서 즐거운 시간을 보냈다.
	CASE 2
		PRINTFORMW %PRONOUN(대상)%와의 회화가 활기를 띠었다.
	CASE 3
		PRINTFORMW 까불며 떠드는 %PRONOUN(대상)%에 좌지우지되었다.
	CASE 4
		PRINTFORMW 너무 즐거워 눈 깜짝할 순간에 시간이 지나 버렸다.
ENDSELECT

PRINTFORML
결과 = 100 + RAND:100 + 능력
CFLAG:대상:호감도 += 결과
MONEY -= 3000
SIF CFLAG:대상:안면 == 0
	CFLAG:대상:안면 = 1
PRINTFORML %ANAME(대상)%의 호감도가 {결과} 상승했다
PRINTFORML 금 3, 000을 소비했다

IF !이벤트발생
	CALL KOJO_DATE_EVENT(대상, 내용)
	SIF RESULT
		이벤트발생 = 1
ENDIF

PRINTFORMW 
IF SHOP_TIME < CALC_SHOP_TIME()
	CALL COOK_HEAL(MASTER)
	SIF 전소비
		GOTO DATE_LOOP
	RESTART
ENDIF

;데이트 이벤트가 발생하고 있지 않으면, 키스와 고백을 받을지도 모른다
IF !이벤트발생
	;데이트 후, 일정 조건으로 키스 된다
	IF CFLAG:대상:호감도 >= 1000 && RAND:3 == 0
		PRINTFORML 
		PRINTFORML 데이트의 돌아가는 길, 돌연 %ANAME(대상)%에 키스를 되었다
		PRINTFORMW 놀라는 %조사처리(ANAME(MASTER),"를")% 거들떠보지도 않고, %PRONOUN(대상)%는 못된 장난 같게 웃으면 빠른 걸음에 앞에 가 버렸다
		CALL KISS_COMMON(대상, @"%ANAME(MASTER)%의 입술", "데이트 돌아오는 길에서의 화간", 1)
		LOCAL:6 = 1
	ENDIF

	;데이트 후, 일정 조건으로 고백된다
	IF CFLAG:대상:호감도 >= 1500 && !IS_SLAVE(대상) && !IS_SLAVED_BY(대상) && !TALENT:대상:연인 && LOCAL:6 != 1 && RAND:2 == 0
		PRINTFORML 
		PRINTFORML 데이트의 돌아가는 길, 돌연 %ANAME(대상)%에 고백되었다
		PRINTFORML %PRONOUN(대상)%는 희미하게 눈동자를 물기를 띠게 하면서 곧바로 %조사처리(ANAME(MASTER),"를")% 응시해 온다
		PRINTFORML 어떻게 하지?
		CALL ASK_YN("받는다", "거절한다")
		IF RESULT == 1
			PRINTFORML 미안하지만 거절했다
			PRINTFORMW %PRONOUN(대상)%는 일순간 외로운 것 같은 얼굴을 보였지만, 아무 일도 없었는지같이 웃으면 빠른 걸음에 먼저 가 버렸다
		ELSE
			PRINTFORML %조사처리(ANAME(MASTER),"는")% %ANAME(대상)%의 손을 잡으면, 곧바로 응시하고 돌려주어 대답을 했다
			PRINTFORML 하면 %PRONOUN(대상)%는 팟 웃는 얼굴이 되어, 힘차게 %ANAME(MASTER)%에 껴안아 키스했다
			PRINTFORMW 잠깐 달콤한 입맞춤을 주고 받은 뒤로 입술을 떼어 놓으면 어쩐지 쑥스러운 분위기가 흘러, 서로 뺨을 느슨해지게 하면서 손을 잡아 함께 돌아갔다
			CALL KISS_COMMON(대상, @"%ANAME(MASTER)%의 입술", "데이트 돌아오는 길에서의 화간", 1)
			CALL GET_LOVERS(대상)
			TALENT:대상:합의 = 1
			PRINTFORMW %ANAME(대상)%의[합의]를 얻었습니다
		ENDIF
	ENDIF
ENDIF

RESULT = 1

LINES_SHOP = LINECOUNT
BEGIN TURNEND

RETURN 1

